<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>PHP _ Dosya düzeni güvenliği </title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<META content=0 http-equiv=expires>
<link rel="stylesheet" type="text/css" href="main.css" media="screen" />
<script language="JavaScript" src="../js/browser.js"> </script>
<script type="text/javascript">
function myvoid()
{
}
</script>
</head>

<body onLoad="ayarla();">
<div id="taban">
    <table cellpadding="0" cellspacing="0" width="100%">
    <tr><td valign="top">
       <div id="soltaraf">
           <a href="../index.php"><img src="../img/aybim.png" border="0"></a><br /><br />
           <div class="menublock">
               <font color="#8e9ccb"><h3>Tanımlar</h3></font>
               <a href="javascript:myvoid();" class="nav">Başlarken</a>
               <a href="phptxt11.html" class="sub">ilk Anlatım</a>
               <a href="javascript:myvoid();" class="nav">Kurulumlar</a>
               <a href="phptxt21.html" class="sub">Genel Kurulum</a><br />
               <a href="phptxt22.html" class="sub">UNIX Kurulumu</a><br />
               <a href="phptxt23.html" class="sub">OSX Kurulumu</a><br />
               <a href="phptxt24.html" class="sub">Wins Kurulumu</a>
               <a href="javascript:myvoid();" class="nav">Dil Kuralları</a>
               <a href="phptxt31.html" class="sub">Temel yazım</a><br />
               <a href="phptxt32.html" class="sub">Tipler</a><br />
               <a href="phptxt33.html" class="sub">Değişkenler</a><br />
               <a href="phptxt34.html" class="sub">Değişmezler</a><br />
               <a href="phptxt35.html" class="sub">Deyimler</a><br />
               <a href="phptxt36.html" class="sub">İşlemler</a><br />
               <a href="phptxt37.html" class="sub">Kontrol Yapıları</a><br />
               <a href="phptxt38.html" class="sub">İşlevler</a><br />
               <a href="phptxt39.html" class="sub">Sınıflar Nesneler</a><br />
               <a href="phptxt391.html" class="sub">Ad uzayı</a><br />
               <a href="phptxt392.html" class="sub">İstisnalar</a>
               <a href="javascript:myvoid();" class="nav">Güvenlik</a>
               <a href="phptxt41.html" class="sub">Giriş</a><br />
               <a href="phptxt42.html" class="sub">Genel bilgi</a><br />
               <a href="phptxt43.html" class="sub">CGI iklisi</a><br />
               <a href="phptxt44.html" class="sub">Apache modülü</a><br />
               <a href="phptxt45.html" class="sub">Dosyadüzeni</a><br />
               <a href="phptxt46.html" class="sub">Veritabanı</a><br />
               <a href="phptxt47.html" class="sub">Hatalar</a><br />
               <a href="phptxt48.html" class="sub">Diğerleri</a><br />
               <a href="javascript:myvoid();" class="nav">Özellikler</a>
               <a href="phptxt51.html" class="sub">HTTP Şifresi</a><br />
               <a href="phptxt52.html" class="sub">Çerezler</a><br />
               <a href="phptxt53.html" class="sub">Oturumlar</a><br />
               <a href="phptxt54.html" class="sub">XForm</a><br />
               <a href="phptxt55.html" class="sub">DosyaYükleme</a><br />
               <a href="phptxt56.html" class="sub">UzakDosyalar</a><br />
               <a href="phptxt57.html" class="sub">Bağlantılar</a><br />
               <a href="phptxt58.html" class="sub">VTBağlantısı</a>
               <font color="#8e9ccb"><h3>Gelişmiş</h3></font>
               <a href="phptxt7.html" class="nav">Php Kökü</a>
               <a href="phptxt8.html" class="nav">Ekler</a>
           </div>
       </div>
    </td><td valign="top">
       <center><h2>PHP Hyperlink Preprocessor</h2></center>
       <div id="ortataraf">
<!-- cascading style sheets ardaşık stil sayfaları -->
         <span><img src="img/notebook1.gif"></span>
         <div id="canvas">
<div id="sag"><span class="yazi">2 Şubat 2008</span></div>
<div id="bdy" class="yazi">
<h2>Dosya düzeni güvenliği</h2>

Dosya ve dosya yolu erişiminde PHP, sunucu sisteminde kurulan güvenlik konusuna bağlıdır. Bu sizin dosya düzeninde hangi dosyaların okunabileceğinizi ve kontrol edebileceğinizi belirtir. Dünyaca okunabilen dosyalarda, onların tüm kullanıcılar tarafından okunmasında güvenli olduğunu dikkat edilmelidir.
<br /><br />
PHP dosya düzenine kullanıcı boyutlu erişime izin verecek biçimde tasarlanmıştır. Bu nednele PHP kodlamasıyla /etc/passwd dosyasını bile okuma olanağı vardır. Ayrıca ethernet bağlantısı değiştirme ya da uzunca bir yazıyı yazıcıdan yazdırma işini başlatma da yapılabilecek işlerdendir. Bu nedenle okuduğunuz ve yazdığınız dosyaların uygun olanlar olmasına özen göstermelisiniz.
<br /><br />
Aşağıdaki kodlamayı düşünün. Kullanıcı evindeki bir dosyayı silmek istemektedir. Bu PHP web arayüzünün dosya yönetimi için sıklıkla kullanıldığı durumdur. Böylece Apache kullanıcıları kendi evlerindeki dosyaları silebilirler.
<br /><br />
Zayıf değişken kontrolunun götürdüğü yer...
<pre>
&lt;?php
// kullanıcı evinden bir dosya silme
$username = $_POST['user_submitted_name'];
$userfile = $_POST['user_submitted_filename'];
$homedir  = "/home/$username";

unlink("$homedir/$userfile");

echo "Dosya silindi!";
?&gt;
</pre>
"usernem" ve "filename" bir form'dan gönderilmiş değerler olduğundan başkasının adı ve dosyası olarak da gönderilmiş olabilir. Sildiğiniz dosya belki de onların silinmemesini istediği bir dosya olabilir. Bu durumda bir tür yetki kontroluna gereksinim vardır. Örneğin değişkenlerde gönderilen değerler "../etc/" ve "passwd" olsaydı ne olacağını bir düşünün. O zaman kodlama:
<br /><br />
Bir dosya düzeni saldırısı...
<pre>
&lt;?php
// disk üzerinde PHP kullanıcılarının erişim hakkı olan
// herhangi bir yerdeki dosyayı silme.
// Eğer PHP için "root" erişimi varsa:
$username = $_POST['user_submitted_name']; // "../etc"
$userfile = $_POST['user_submitted_filename']; // "passwd"
$homedir  = "/home/$username"; // "/home/../etc"

unlink("$homedir/$userfile"); // "/home/../etc/passwd"

echo "Dosya silindi";
?&gt;
</pre>
Bunların olmaması için iki önemli konu vardır:
<ul>
    <li> PHP web kullanıcısı ikilisine yalnız sınırlı erişim hakkı verin
    <li> Gönderilen tüm değişkenleri kontrol edin.
</ul>
Burada daha iyi bir kodlama vardır:
<br /><br />
Daha güvenli dosya adı kontrolu
<pre>
&lt;?php
// PHP kullanıcılarının erişim
// hakkı olan diskten dosyaları silme
$username = $_SERVER['REMOTE_USER']; // yetki kontrol sistemi kullanımı
$userfile = basename($_POST['user_submitted_filename']);
$homedir  = "/home/$username";

$filepath = "$homedir/$userfile";

if (file_exists($filepath) && unlink($filepath)) {
    $logstring = "$filepath silindi\n";
} else {
    $logstring = "$filepath silinme hatası\n";
}
$fp = fopen("/home/logging/filedelete.log", "a");
fwrite($fp, $lo gstring);
fclose($fp);

echo htmlentities($logstring, ENT_QUOTES);

?&gt;
</pre>
Bu hala çok iyi durumda değildir. Eğer yetki kontrol sistemi kullanıcılara kendi "log" kayıtlarını yazmalarını sağlıyor ve "../etc/" kullanılıyprsa sistem hala tehlikededir. Bu nedenle daha kişiselleştirilmiş bir kodlama yapmak istersiniz.
<br /><br />
Daha güvenli dosya adı kontrolu
<pre>
&lt;?php
$username     = $_SERVER['REMOTE_USER']; // yetki erişim sistemi kullanımı
$userfile     = $_POST['user_submitted_filename'];
$homedir      = "/home/$username";

$filepath     = "$homedir/$userfile";

if (!ctype_alnum($username) || !preg_match('/^(?:[a-z0-9_-]|\.(?!\.))+$/iD', $userfile)) {
    die("Kötü kullanıcı adı/dosya adı");
}

//etc...
?&gt;
</pre>
İsletim sisteminize bağlı olarak, düşünülmesi gereken birçok dosya vardır. Donanım girişleri (/dev/ ya da COM1 gibi), ayar dosyaları (/etc/ dosyaları ve .ini dosyaları gibi) ve çok bilinen bilgi saklama yerleri (/home/, My Documents) gibi birçok önemli dosya ortamı ve yeri vardır. Bu nedenle sizin izin verdiğinizin dışındaki herşeyi engelleme politikası daha iyi bir çözümdür.
<h3>Null bayt ile ilgili işler</h3>
PHP, C işlevlerine ilişkin işlemlerde NULL değerini beklendiği bir ele alır. C dilinde Null bayt dizi sonunu belirtir. Bir dizinin içinde olduğunda dizinin o noktaya değin olduğu varsayılır. Aşağıdaki örnek bunu gösterir
<br /><br />
Null bayt için kodlama
<pre>
&lt;?php
$file = $_GET['file']; // "../../etc/passwd\0"
if (file_exists('/home/wwwrun/'.$file.'.php')) {
    // file_exists, /home/wwwrun/../../etc/passwd dosyası varsa doğru döndürür
    include '/home/wwwrun/'.$file.'.php';
    // /etc/passwd dosyası da eklenir
}
?&gt;
</pre>
O halde hangi işletim sisteminde olursanız olun, işlem her şeyden önce doğru denetlenmelidir. Yukarıdaki örneğin daha iyi bir sürümü şöyledir:
<br /><br />
Girişleri doğru denetleme
<pre>
&lt;?php
$file = $_GET['file']; 

// Olası değerler listesi
switch ($file) {
    case 'main':
    case 'foo':
    case 'bar':
        include '/home/wwwrun/include/'.$file.'.php';
        break;
    default:
        include '/home/wwwrun/include/main.php';
}
?&gt;
</pre>
<br />
</div>
         </div>
         <span><img src="img/notebook1.gif"><br /></span>
       </div>
    </td><td valign="top">
       <div id="sagtaraf">
<script type="text/javascript"><!--
google_ad_client = "pub-8541306787668208";
//120x600, created 1/16/08
google_ad_slot = "7007060807";
google_ad_width = 120;
google_ad_height = 600;
//--></script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<br />
<script type="text/javascript"><!--
google_ad_client = "pub-8541306787668208";
//120x240, created 1/25/08
google_ad_slot = "8433790203";
google_ad_width = 120;
google_ad_height = 240;
google_cpa_choice = ""; // on file
//--></script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

       </div>
    </td></tr>
    </table>
</div>
</body>
</html>
